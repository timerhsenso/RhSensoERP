@* =============================================================================
   TABSHEET GENERATOR v2.0 - MODAL WIZARD PROFISSIONAL
   Gerador de telas Mestre/Detalhe com CRUD completo
   ============================================================================= *@

<!-- MODAL PRINCIPAL -->
<div class="modal fade" id="modalTabSheet" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content" style="background: var(--bg-primary);">

            <!-- HEADER -->
            <div class="modal-header ts-header">
                <div class="d-flex align-items-center gap-3">
                    <div class="ts-logo">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-0">TabSheet Generator <span class="badge bg-info">v2.0</span></h5>
                        <small class="text-muted">Gerador de Telas Mestre/Detalhe</small>
                    </div>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <span class="ts-table-badge" id="tsCurrentTable">
                        <i class="fas fa-table me-1"></i>
                        <span id="tsTableName">-</span>
                    </span>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
            </div>

            <!-- WIZARD STEPS -->
            <div class="ts-wizard-container">
                <div class="ts-wizard-steps">
                    <div class="ts-step active" data-step="1">
                        <div class="ts-step-number">1</div>
                        <div class="ts-step-info">
                            <span class="ts-step-title">Identificação</span>
                            <span class="ts-step-desc">Dados básicos</span>
                        </div>
                    </div>
                    <div class="ts-step-connector"></div>
                    <div class="ts-step" data-step="2">
                        <div class="ts-step-number">2</div>
                        <div class="ts-step-info">
                            <span class="ts-step-title">Tabela Mestre</span>
                            <span class="ts-step-desc">CRUD principal</span>
                        </div>
                    </div>
                    <div class="ts-step-connector"></div>
                    <div class="ts-step" data-step="3">
                        <div class="ts-step-number">3</div>
                        <div class="ts-step-info">
                            <span class="ts-step-title">Tabelas Detalhe</span>
                            <span class="ts-step-desc">Abas filhas</span>
                        </div>
                    </div>
                    <div class="ts-step-connector"></div>
                    <div class="ts-step" data-step="4">
                        <div class="ts-step-number">4</div>
                        <div class="ts-step-info">
                            <span class="ts-step-title">Finalizar</span>
                            <span class="ts-step-desc">Opções e geração</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BODY - CONTEÚDO DOS PASSOS -->
            <div class="modal-body ts-body">

                <!-- LOADING -->
                <div id="tsLoading" class="ts-loading">
                    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
                    <h5 class="mt-3">Carregando metadados...</h5>
                    <p class="text-muted">Analisando estrutura da tabela</p>
                </div>

                <!-- ================================================================
                     PASSO 1: IDENTIFICAÇÃO
                     ================================================================ -->
                <div class="ts-step-content active" data-step="1">
                    <div class="ts-section-header">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Informações Básicas</h4>
                            <p>Configure a identificação e o módulo da tela</p>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="ts-form-group">
                                <label class="ts-label required">ID da Configuração</label>
                                <input type="text" class="form-control ts-input" id="tsConfigId"
                                       placeholder="Ex: Funcionario_TabSheet" />
                                <small class="ts-hint">Identificador único (sem espaços)</small>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="ts-form-group">
                                <label class="ts-label required">Título da Tela</label>
                                <input type="text" class="form-control ts-input" id="tsTitle"
                                       placeholder="Ex: Cadastro de Funcionários" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="ts-form-group">
                                <label class="ts-label">Módulo</label>
                                <select class="form-select ts-input" id="tsModule">
                                    <option value="GestaoDePessoas">Gestão de Pessoas</option>
                                    <option value="ControleDePonto">Controle de Ponto</option>
                                    <option value="Treinamentos">Treinamentos</option>
                                    <option value="SaudeOcupacional">Saúde Ocupacional</option>
                                    <option value="Seguranca">Segurança</option>
                                    <option value="Avaliacao">Avaliação</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="ts-form-group">
                                <label class="ts-label">Descrição</label>
                                <textarea class="form-control ts-input" id="tsDescription" rows="2"
                                          placeholder="Descrição opcional da funcionalidade..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- INFO DA TABELA MESTRE -->
                    <div class="ts-section-header mt-5">
                        <i class="fas fa-database"></i>
                        <div>
                            <h4>Tabela Mestre Selecionada</h4>
                            <p>Informações da tabela principal</p>
                        </div>
                    </div>

                    <div class="ts-master-info-card">
                        <div class="row g-4">
                            <div class="col-md-3">
                                <div class="ts-info-item">
                                    <label>Tabela</label>
                                    <div class="ts-info-value" id="tsMasterTableName">-</div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="ts-info-item">
                                    <label>Schema</label>
                                    <div class="ts-info-value" id="tsMasterSchema">dbo</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="ts-info-item">
                                    <label>Primary Key</label>
                                    <div class="ts-info-value">
                                        <span class="badge ts-badge-pk" id="tsMasterPK">-</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="ts-info-item">
                                    <label>Colunas</label>
                                    <div class="ts-info-value">
                                        <span class="badge bg-secondary" id="tsMasterColCount">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="ts-info-item">
                                    <label>FKs</label>
                                    <div class="ts-info-value">
                                        <span class="badge ts-badge-fk" id="tsMasterFKCount">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ================================================================
                     PASSO 2: TABELA MESTRE (CRUD COMPLETO)
                     ================================================================ -->
                <div class="ts-step-content" data-step="2">

                    <!-- Sub-tabs para Listagem e Formulário -->
                    <ul class="nav nav-pills ts-sub-tabs mb-4" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#masterListagem">
                                <i class="fas fa-list me-2"></i>Colunas da Listagem
                                <span class="badge bg-light text-dark ms-2" id="masterListagemCount">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#masterFormulario">
                                <i class="fas fa-edit me-2"></i>Campos do Formulário
                                <span class="badge bg-light text-dark ms-2" id="masterFormularioCount">0</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#masterRelacionamentos">
                                <i class="fas fa-link me-2"></i>Relacionamentos
                                <span class="badge bg-light text-dark ms-2" id="masterFKsCount">0</span>
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <!-- TAB: Colunas da Listagem -->
                        <div class="tab-pane fade show active" id="masterListagem">
                            <div class="ts-section-header">
                                <i class="fas fa-table"></i>
                                <div>
                                    <h4>Colunas da Listagem (DataTable)</h4>
                                    <p>Selecione e configure as colunas que aparecerão na tabela de listagem</p>
                                </div>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-outline-primary" onclick="TabSheetV2.selectAllMasterListagem(true)">
                                        <i class="fas fa-check-square me-1"></i>Todas
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="TabSheetV2.selectAllMasterListagem(false)">
                                        <i class="fas fa-square me-1"></i>Nenhuma
                                    </button>
                                </div>
                            </div>
                            <div class="ts-table-container">
                                <table class="table ts-config-table" id="masterListagemTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">
                                                <input type="checkbox" class="form-check-input" id="checkAllMasterListagem" checked />
                                            </th>
                                            <th>Coluna</th>
                                            <th>Título</th>
                                            <th style="width: 120px;">Formato</th>
                                            <th style="width: 100px;">Largura</th>
                                            <th style="width: 100px;">Alinhamento</th>
                                            <th style="width: 80px;" class="text-center">Ordenável</th>
                                        </tr>
                                    </thead>
                                    <tbody id="masterListagemBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- TAB: Campos do Formulário -->
                        <div class="tab-pane fade" id="masterFormulario">
                            <div class="ts-section-header">
                                <i class="fas fa-wpforms"></i>
                                <div>
                                    <h4>Campos do Formulário</h4>
                                    <p>Configure os campos que aparecerão no formulário de cadastro/edição</p>
                                </div>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-outline-primary" onclick="TabSheetV2.selectAllMasterForm(true)">
                                        <i class="fas fa-check-square me-1"></i>Todos
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="TabSheetV2.selectAllMasterForm(false)">
                                        <i class="fas fa-square me-1"></i>Nenhum
                                    </button>
                                </div>
                            </div>
                            <div class="ts-table-container">
                                <table class="table ts-config-table" id="masterFormularioTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">
                                                <input type="checkbox" class="form-check-input" id="checkAllMasterForm" checked />
                                            </th>
                                            <th>Campo</th>
                                            <th>Label</th>
                                            <th style="width: 140px;">Tipo de Input</th>
                                            <th style="width: 100px;">Tamanho (col)</th>
                                            <th style="width: 80px;" class="text-center">Obrig.</th>
                                            <th style="width: 80px;" class="text-center">Desab.</th>
                                        </tr>
                                    </thead>
                                    <tbody id="masterFormularioBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- TAB: Relacionamentos -->
                        <div class="tab-pane fade" id="masterRelacionamentos">
                            <div class="ts-section-header">
                                <i class="fas fa-project-diagram"></i>
                                <div>
                                    <h4>Relacionamentos (Foreign Keys)</h4>
                                    <p>Configure as navigation properties e lookups</p>
                                </div>
                            </div>
                            <div id="masterFKsContainer" class="row g-3"></div>
                        </div>
                    </div>
                </div>

                <!-- ================================================================
                     PASSO 3: TABELAS DETALHE (ABAS)
                     ================================================================ -->
                <div class="ts-step-content" data-step="3">

                    <div class="row g-4">
                        <!-- COLUNA ESQUERDA: Lista de tabelas disponíveis -->
                        <div class="col-md-4">
                            <div class="ts-panel">
                                <div class="ts-panel-header">
                                    <h5><i class="fas fa-database me-2"></i>Tabelas Disponíveis</h5>
                                    <span class="badge bg-secondary" id="tsAvailableCount">0</span>
                                </div>
                                <div class="ts-panel-body">
                                    <div class="ts-search-box mb-3">
                                        <i class="fas fa-search"></i>
                                        <input type="text" class="form-control" id="tsSearchDetail"
                                               placeholder="Buscar tabela..." />
                                    </div>
                                    <div class="ts-available-list" id="tsAvailableList">
                                        <!-- Tabelas disponíveis serão inseridas aqui -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- COLUNA DIREITA: Abas selecionadas e configuração -->
                        <div class="col-md-8">
                            <div class="ts-panel">
                                <div class="ts-panel-header">
                                    <h5><i class="fas fa-folder-tree me-2"></i>Abas Selecionadas</h5>
                                    <span class="badge bg-primary" id="tsSelectedCount">0</span>
                                </div>
                                <div class="ts-panel-body p-0">
                                    <!-- Tabs das abas selecionadas -->
                                    <ul class="nav nav-tabs ts-detail-tabs" id="tsDetailTabs" role="tablist">
                                        <!-- Abas dinâmicas -->
                                    </ul>

                                    <!-- Conteúdo de cada aba -->
                                    <div class="tab-content" id="tsDetailTabsContent">
                                        <div class="ts-empty-state" id="tsNoTabsMessage">
                                            <i class="fas fa-hand-point-left"></i>
                                            <h5>Nenhuma aba selecionada</h5>
                                            <p>Clique em uma tabela à esquerda para adicionar como aba</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ================================================================
                     PASSO 4: OPÇÕES E GERAÇÃO
                     ================================================================ -->
                <div class="ts-step-content" data-step="4">

                    <div class="row g-4">
                        <!-- Opções de Geração -->
                        <div class="col-md-6">
                            <div class="ts-panel">
                                <div class="ts-panel-header">
                                    <h5><i class="fas fa-cogs me-2"></i>Opções de Geração</h5>
                                </div>
                                <div class="ts-panel-body">
                                    <div class="row g-4">
                                        <div class="col-6">
                                            <h6 class="ts-option-title"><i class="fas fa-server me-2"></i>Backend</h6>
                                            <div class="ts-option-group">
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optMasterEntity" checked />
                                                    <label class="form-check-label" for="optMasterEntity">Entidade Mestre</label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optDetailEntities" checked />
                                                    <label class="form-check-label" for="optDetailEntities">Entidades Detalhe</label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optDTOs" checked />
                                                    <label class="form-check-label" for="optDTOs">
                                                        <i class="fas fa-cube text-primary me-1"></i>DTOs (Dto, Request)
                                                    </label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optServices" checked />
                                                    <label class="form-check-label" for="optServices">
                                                        <i class="fas fa-cog text-success me-1"></i>Services (API)
                                                    </label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optNavigations" checked />
                                                    <label class="form-check-label" for="optNavigations">Navigation Properties</label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optController" checked />
                                                    <label class="form-check-label" for="optController">Controller MVC</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <h6 class="ts-option-title"><i class="fas fa-desktop me-2"></i>Frontend</h6>
                                            <div class="ts-option-group">
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optMasterView" checked />
                                                    <label class="form-check-label" for="optMasterView">View Principal</label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optTabPartials" checked />
                                                    <label class="form-check-label" for="optTabPartials">Partials das Abas</label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optJavaScript" checked />
                                                    <label class="form-check-label" for="optJavaScript">JavaScript</label>
                                                </div>
                                                <div class="form-check ts-check">
                                                    <input type="checkbox" class="form-check-input" id="optDataTables" checked />
                                                    <label class="form-check-label" for="optDataTables">DataTables</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Configurações Adicionais -->
                            <div class="ts-panel mt-4">
                                <div class="ts-panel-header">
                                    <h5><i class="fas fa-sliders-h me-2"></i>Configurações</h5>
                                </div>
                                <div class="ts-panel-body">
                                    <div class="row g-3">
                                        <div class="col-6">
                                            <label class="ts-label">Rota do Módulo</label>
                                            <input type="text" class="form-control ts-input" id="tsModuleRoute"
                                                   placeholder="gestaodepessoas" />
                                        </div>
                                        <div class="col-6">
                                            <label class="ts-label">Ícone da Tela</label>
                                            <input type="text" class="form-control ts-input" id="tsIcon"
                                                   value="fas fa-table" />
                                        </div>
                                        <div class="col-6">
                                            <label class="ts-label">Código da Função (CdFuncao)</label>
                                            <input type="text" class="form-control ts-input" id="tsCdFuncao"
                                                   placeholder="CRUD_ENTIDADE" />
                                            <small class="text-muted">Código para controle de permissões</small>
                                        </div>
                                        <div class="col-6">
                                            <label class="ts-label">Sistema (CdSistema)</label>
                                            <input type="text" class="form-control ts-input" id="tsCdSistema"
                                                   value="RHU" placeholder="RHU" />
                                            <small class="text-muted">Ex: RHU, FIN, ADM</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Resumo -->
                        <div class="col-md-6">
                            <div class="ts-panel ts-summary-panel">
                                <div class="ts-panel-header">
                                    <h5><i class="fas fa-clipboard-list me-2"></i>Resumo da Geração</h5>
                                </div>
                                <div class="ts-panel-body">
                                    <div class="ts-summary">
                                        <div class="ts-summary-section">
                                            <h6><i class="fas fa-table me-2"></i>Tabela Mestre</h6>
                                            <div class="ts-summary-item">
                                                <span>Tabela:</span>
                                                <strong id="summaryMasterTable">-</strong>
                                            </div>
                                            <div class="ts-summary-item">
                                                <span>Colunas na Listagem:</span>
                                                <strong id="summaryMasterListCols">0</strong>
                                            </div>
                                            <div class="ts-summary-item">
                                                <span>Campos no Formulário:</span>
                                                <strong id="summaryMasterFormCols">0</strong>
                                            </div>
                                        </div>

                                        <div class="ts-summary-section">
                                            <h6><i class="fas fa-folder-tree me-2"></i>Tabelas Detalhe</h6>
                                            <div id="summaryDetailTabs">
                                                <p class="text-muted">Nenhuma aba selecionada</p>
                                            </div>
                                        </div>

                                        <div class="ts-summary-section">
                                            <h6><i class="fas fa-file-code me-2"></i>Arquivos a Gerar</h6>
                                            <div id="summaryFiles" class="ts-file-list">
                                                <!-- Lista de arquivos -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- FOOTER -->
            <div class="modal-footer ts-footer">
                <div class="ts-footer-left">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                </div>
                <div class="ts-footer-right">
                    <button type="button" class="btn btn-outline-primary" id="btnPrevStep" style="display: none;">
                        <i class="fas fa-chevron-left me-2"></i>Anterior
                    </button>
                    <button type="button" class="btn btn-primary" id="btnNextStep">
                        Próximo<i class="fas fa-chevron-right ms-2"></i>
                    </button>
                    <button type="button" class="btn btn-info text-white" id="btnPreview" style="display: none;">
                        <i class="fas fa-eye me-2"></i>Preview
                    </button>
                    <button type="button" class="btn ts-btn-generate" id="btnGenerate" style="display: none;">
                        <i class="fas fa-download me-2"></i>Gerar e Baixar ZIP
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- TEMPLATE: Linha da tabela de listagem -->
<template id="templateListagemRow">
    <tr data-col="{colName}">
        <td>
            <input type="checkbox" class="form-check-input listagem-check" checked />
        </td>
        <td>
            <code class="ts-code">{colName}</code>
            <span class="ts-col-badges">{badges}</span>
        </td>
        <td>
            <input type="text" class="form-control form-control-sm ts-input-sm listagem-title" value="{title}" />
        </td>
        <td>
            <select class="form-select form-select-sm ts-input-sm listagem-format">
                <option value="text">Texto</option>
                <option value="date">Data</option>
                <option value="datetime">Data/Hora</option>
                <option value="currency">Moeda</option>
                <option value="number">Número</option>
                <option value="boolean">Sim/Não</option>
            </select>
        </td>
        <td>
            <input type="text" class="form-control form-control-sm ts-input-sm listagem-width" placeholder="auto" />
        </td>
        <td>
            <select class="form-select form-select-sm ts-input-sm listagem-align">
                <option value="left">Esquerda</option>
                <option value="center">Centro</option>
                <option value="right">Direita</option>
            </select>
        </td>
        <td class="text-center">
            <input type="checkbox" class="form-check-input listagem-sortable" checked />
        </td>
    </tr>
</template>

<!-- TEMPLATE: Linha da tabela de formulário -->
<template id="templateFormularioRow">
    <tr data-col="{colName}">
        <td>
            <input type="checkbox" class="form-check-input formulario-check" checked />
        </td>
        <td>
            <code class="ts-code">{colName}</code>
            <span class="ts-col-badges">{badges}</span>
        </td>
        <td>
            <input type="text" class="form-control form-control-sm ts-input-sm formulario-label" value="{label}" />
        </td>
        <td>
            <select class="form-select form-select-sm ts-input-sm formulario-type">
                <option value="text">Texto</option>
                <option value="number">Número</option>
                <option value="date">Data</option>
                <option value="datetime-local">Data/Hora</option>
                <option value="checkbox">Checkbox</option>
                <option value="select">Select</option>
                <option value="textarea">Textarea</option>
                <option value="email">E-mail</option>
                <option value="password">Senha</option>
            </select>
        </td>
        <td>
            <select class="form-select form-select-sm ts-input-sm formulario-colsize">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="6">6</option>
                <option value="8">8</option>
                <option value="12">12</option>
            </select>
        </td>
        <td class="text-center">
            <input type="checkbox" class="form-check-input formulario-required" />
        </td>
        <td class="text-center">
            <input type="checkbox" class="form-check-input formulario-disabled" />
        </td>
    </tr>
</template>

<!-- TEMPLATE: Card de tabela disponível -->
<template id="templateAvailableTable">
    <div class="ts-available-item" data-table="{tableName}">
        <div class="ts-available-info">
            <div class="ts-available-name">{displayName}</div>
            <div class="ts-available-meta">
                <span><i class="fas fa-key"></i> {fkColumn}</span>
                <span><i class="fas fa-columns"></i> {colCount} cols</span>
            </div>
        </div>
        <button class="btn btn-sm btn-primary ts-btn-add" onclick="TabSheetV2.addDetailTab('{tableName}')">
            <i class="fas fa-plus"></i>
        </button>
    </div>
</template>

<!-- TEMPLATE: Aba de detalhe -->
<template id="templateDetailTab">
    <li class="nav-item" data-table="{tableName}">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#detail-{tableName}">
            <i class="{icon} me-1"></i>
            <span>{title}</span>
            <span class="ts-tab-close" onclick="TabSheetV2.removeDetailTab('{tableName}', event)">
                <i class="fas fa-times"></i>
            </span>
        </button>
    </li>
</template>

<!-- TEMPLATE: Conteúdo da aba de detalhe -->
<template id="templateDetailContent">
    <div class="tab-pane fade" id="detail-{tableName}" data-table="{tableName}">
        <div class="ts-detail-config p-4">
            <!-- Header da aba -->
            <div class="ts-detail-header mb-4">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="ts-label">Título da Aba</label>
                        <input type="text" class="form-control ts-input detail-title" value="{title}" />
                    </div>
                    <div class="col-md-2">
                        <label class="ts-label">Ícone</label>
                        <input type="text" class="form-control ts-input detail-icon" value="{icon}" />
                    </div>
                    <div class="col-md-2">
                        <label class="ts-label">Ordem</label>
                        <input type="number" class="form-control ts-input detail-order" value="{order}" />
                    </div>
                    <div class="col-md-5">
                        <div class="ts-permissions">
                            <label class="ts-label">Permissões</label>
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input detail-allow-create" checked />
                                    <label class="form-check-label">Criar</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input detail-allow-edit" checked />
                                    <label class="form-check-label">Editar</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input detail-allow-delete" checked />
                                    <label class="form-check-label">Excluir</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sub-tabs para Listagem e Formulário do Detalhe -->
            <ul class="nav nav-pills ts-sub-tabs mb-3" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#detail-{tableName}-listagem">
                        <i class="fas fa-list me-2"></i>Listagem
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="pill" data-bs-target="#detail-{tableName}-formulario">
                        <i class="fas fa-edit me-2"></i>Formulário
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <!-- Listagem do Detalhe -->
                <div class="tab-pane fade show active" id="detail-{tableName}-listagem">
                    <div class="ts-table-container" style="max-height: 300px;">
                        <table class="table ts-config-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;"><input type="checkbox" class="form-check-input" checked /></th>
                                    <th>Coluna</th>
                                    <th>Título</th>
                                    <th style="width: 120px;">Formato</th>
                                    <th style="width: 100px;">Largura</th>
                                    <th style="width: 100px;">Alinhamento</th>
                                </tr>
                            </thead>
                            <tbody class="detail-listagem-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Formulário do Detalhe -->
                <div class="tab-pane fade" id="detail-{tableName}-formulario">
                    <div class="ts-table-container" style="max-height: 300px;">
                        <table class="table ts-config-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;"><input type="checkbox" class="form-check-input" checked /></th>
                                    <th>Campo</th>
                                    <th>Label</th>
                                    <th style="width: 140px;">Tipo</th>
                                    <th style="width: 100px;">Tamanho</th>
                                    <th style="width: 80px;" class="text-center">Obrig.</th>
                                </tr>
                            </thead>
                            <tbody class="detail-formulario-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- ESTILOS ESPECÍFICOS DO TABSHEET -->
<style>
    /* ==================== VARIÁVEIS ==================== */
    .ts-header {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border: none;
        padding: 1rem 1.5rem;
    }

    .ts-logo {
        width: 48px;
        height: 48px;
        background: rgba(255,255,255,0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .ts-header .modal-title {
        color: white;
        font-weight: 700;
    }

    .ts-header small {
        color: rgba(255,255,255,0.8) !important;
    }

    .ts-table-badge {
        background: rgba(255,255,255,0.2);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
    }

    /* ==================== WIZARD STEPS ==================== */
    .ts-wizard-container {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem 2rem;
    }

    [data-theme="dark"] .ts-wizard-container {
        border-bottom: none;
    }

    .ts-wizard-steps {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
    }

    .ts-step {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 1rem;
        border-radius: 12px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .ts-step:hover {
            background: var(--bg-hover);
        }

    .ts-step-number {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--bg-tertiary);
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .ts-step.active .ts-step-number,
    .ts-step.completed .ts-step-number {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
    }

        .ts-step.completed .ts-step-number::after {
            content: '✓';
        }

    .ts-step-info {
        display: flex;
        flex-direction: column;
    }

    .ts-step-title {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.9rem;
    }

    .ts-step-desc {
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    .ts-step.active .ts-step-title {
        color: #6366f1;
    }

    .ts-step-connector {
        width: 60px;
        height: 2px;
        background: var(--border-color);
        margin: 0 0.5rem;
    }

    .ts-step.completed + .ts-step-connector {
        background: linear-gradient(90deg, #6366f1, #8b5cf6);
    }

    /* ==================== BODY ==================== */
    .ts-body {
        padding: 2rem;
        overflow-y: auto;
        max-height: calc(100vh - 250px);
    }

    .ts-step-content {
        display: none;
        animation: fadeIn 0.3s ease;
    }

        .ts-step-content.active {
            display: block;
        }

    /* CORRIGIDO: keyframes precisa de @@ no Razor */
    @@keyframes fadeIn {
        from

    {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    /* ==================== LOADING ==================== */
    .ts-loading {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--bg-primary);
        z-index: 100;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

        .ts-loading.active {
            display: flex;
        }

    /* ==================== SECTION HEADERS ==================== */
    .ts-section-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    [data-theme="dark"] .ts-section-header {
        border-bottom-color: var(--bg-tertiary);
    }

    .ts-section-header > i {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
        flex-shrink: 0;
    }

    .ts-section-header h4 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .ts-section-header p {
        margin: 0.25rem 0 0 0;
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    /* ==================== FORM ELEMENTS ==================== */
    .ts-form-group {
        margin-bottom: 0;
    }

    .ts-label {
        display: block;
        font-weight: 600;
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
    }

        .ts-label.required::after {
            content: ' *';
            color: #ef4444;
        }

    .ts-input {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }

        .ts-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

    [data-theme="dark"] .ts-input {
        background: var(--bg-tertiary);
        border-color: var(--bg-tertiary);
    }

    .ts-input-sm {
        padding: 0.3rem 0.5rem;
        font-size: 0.8rem;
    }

    .ts-hint {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }

    /* ==================== MASTER INFO CARD ==================== */
    .ts-master-info-card {
        background: var(--bg-tertiary);
        border-radius: 12px;
        padding: 1.5rem;
    }

    [data-theme="dark"] .ts-master-info-card {
        background: var(--bg-secondary);
    }

    .ts-info-item label {
        display: block;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
    }

    .ts-info-value {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    /* ==================== BADGES ==================== */
    .ts-badge-pk {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #000;
    }

    .ts-badge-fk {
        background: linear-gradient(135deg, #60a5fa, #3b82f6);
        color: #fff;
    }

    .ts-badge-identity {
        background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        color: #fff;
    }

    .ts-col-badges {
        margin-left: 0.5rem;
    }

        .ts-col-badges .badge {
            font-size: 0.6rem;
            padding: 0.15em 0.4em;
            margin-right: 0.25rem;
        }

    /* ==================== SUB-TABS ==================== */
    .ts-sub-tabs {
        background: var(--bg-tertiary);
        padding: 0.5rem;
        border-radius: 10px;
        gap: 0.5rem;
    }

    [data-theme="dark"] .ts-sub-tabs {
        background: var(--bg-secondary);
    }

    .ts-sub-tabs .nav-link {
        border-radius: 8px;
        padding: 0.6rem 1.2rem;
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }

        .ts-sub-tabs .nav-link.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .ts-sub-tabs .nav-link:not(.active):hover {
            background: var(--bg-hover);
        }

    /* ==================== CONFIG TABLE ==================== */
    .ts-table-container {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid var(--border-color);
        border-radius: 8px;
    }

    [data-theme="dark"] .ts-table-container {
        border-color: var(--bg-tertiary);
    }

    .ts-config-table {
        margin: 0;
        font-size: 0.85rem;
    }

        .ts-config-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

            .ts-config-table thead th {
                background: var(--bg-tertiary);
                border-bottom: 1px solid var(--border-color);
                font-size: 0.7rem;
                text-transform: uppercase;
                letter-spacing: 0.03em;
                color: var(--text-muted);
                padding: 0.75rem;
                font-weight: 600;
            }

    [data-theme="dark"] .ts-config-table thead th {
        background: var(--bg-secondary);
        border-color: transparent;
    }

    .ts-config-table tbody td {
        padding: 0.5rem 0.75rem;
        vertical-align: middle;
        border-color: var(--border-light);
    }

    [data-theme="dark"] .ts-config-table tbody td {
        border-color: transparent;
    }

    .ts-config-table tbody tr:hover {
        background: var(--bg-hover);
    }

    .ts-code {
        background: var(--bg-tertiary);
        padding: 0.2em 0.5em;
        border-radius: 4px;
        font-size: 0.8rem;
        color: #6366f1;
    }

    [data-theme="dark"] .ts-code {
        color: #a5b4fc;
    }

    /* ==================== PANELS ==================== */
    .ts-panel {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        overflow: hidden;
    }

    [data-theme="dark"] .ts-panel {
        border: none;
    }

    .ts-panel-header {
        background: var(--bg-tertiary);
        padding: 1rem 1.25rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border-color);
    }

    [data-theme="dark"] .ts-panel-header {
        border-bottom: none;
    }

    .ts-panel-header h5 {
        margin: 0;
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .ts-panel-body {
        padding: 1rem 1.25rem;
    }

    /* ==================== AVAILABLE LIST ==================== */
    .ts-search-box {
        position: relative;
    }

        .ts-search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .ts-search-box input {
            padding-left: 38px;
        }

    .ts-available-list {
        max-height: 450px;
        overflow-y: auto;
    }

    .ts-available-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        background: var(--bg-tertiary);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    [data-theme="dark"] .ts-available-item {
        background: var(--bg-primary);
    }

    .ts-available-item:hover {
        background: var(--bg-hover);
        transform: translateX(4px);
    }

    .ts-available-item.added {
        opacity: 0.5;
        pointer-events: none;
    }

    .ts-available-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.9rem;
    }

    .ts-available-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }

        .ts-available-meta i {
            margin-right: 0.25rem;
        }

    .ts-btn-add {
        width: 32px;
        height: 32px;
        padding: 0;
        border-radius: 8px;
    }

    /* ==================== DETAIL TABS ==================== */
    .ts-detail-tabs {
        background: var(--bg-tertiary);
        padding: 0.5rem 0.5rem 0 0.5rem;
        border-bottom: 1px solid var(--border-color);
    }

    [data-theme="dark"] .ts-detail-tabs {
        border-bottom: none;
    }

    .ts-detail-tabs .nav-link {
        border: none;
        border-radius: 8px 8px 0 0;
        padding: 0.6rem 1rem;
        color: var(--text-secondary);
        font-weight: 500;
        position: relative;
    }

        .ts-detail-tabs .nav-link.active {
            background: var(--bg-secondary);
            color: #6366f1;
        }

    .ts-tab-close {
        margin-left: 0.5rem;
        padding: 0.2rem;
        border-radius: 4px;
        opacity: 0.5;
        transition: all 0.2s;
    }

        .ts-tab-close:hover {
            opacity: 1;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

    .ts-detail-config {
        min-height: 400px;
    }

    /* ==================== EMPTY STATE ==================== */
    .ts-empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 4rem 2rem;
        color: var(--text-muted);
    }

        .ts-empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .ts-empty-state h5 {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

    /* ==================== OPTIONS ==================== */
    .ts-option-title {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        color: var(--text-muted);
        margin-bottom: 1rem;
        font-weight: 600;
    }

    .ts-option-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .ts-check .form-check-label {
        font-size: 0.9rem;
        color: var(--text-primary);
    }

    /* ==================== SUMMARY ==================== */
    .ts-summary-panel {
        height: 100%;
    }

    .ts-summary-section {
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-light);
    }

        .ts-summary-section:last-child {
            border-bottom: none;
        }

    [data-theme="dark"] .ts-summary-section {
        border-color: var(--bg-tertiary);
    }

    .ts-summary-section h6 {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        color: var(--text-muted);
        margin-bottom: 0.75rem;
    }

    .ts-summary-item {
        display: flex;
        justify-content: space-between;
        padding: 0.4rem 0;
        font-size: 0.9rem;
    }

        .ts-summary-item span {
            color: var(--text-secondary);
        }

        .ts-summary-item strong {
            color: var(--text-primary);
        }

    .ts-file-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .ts-file-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--text-secondary);
    }

        .ts-file-item i {
            color: #6366f1;
        }

    /* ==================== FOOTER ==================== */
    .ts-footer {
        background: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
    }

    [data-theme="dark"] .ts-footer {
        border-top: none;
    }

    .ts-footer-right {
        display: flex;
        gap: 0.75rem;
    }

    .ts-btn-generate {
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.6rem 1.5rem;
    }

        .ts-btn-generate:hover {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

    /* ==================== FK CARDS ==================== */
    .ts-fk-card {
        background: var(--bg-tertiary);
        border-radius: 8px;
        padding: 1rem;
        border-left: 3px solid #6366f1;
    }

    [data-theme="dark"] .ts-fk-card {
        background: var(--bg-primary);
    }

    .ts-fk-card .fk-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .ts-fk-card .fk-name {
        font-weight: 600;
        color: #6366f1;
    }

    .ts-fk-card .fk-detail {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    /* ==================== RESPONSIVE ==================== */
    /* CORRIGIDO: media precisa de @@ no Razor */
    @@media (max-width: 768px) {
        .ts-wizard-steps

    {
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .ts-step-connector {
        display: none;
    }

    .ts-step {
        flex: 1 1 45%;
    }

    }

    /* ==================== FILE LIST STYLES ==================== */
    .ts-file-list {
        max-height: 300px;
        overflow-y: auto;
    }

    .ts-file-item {
        display: flex;
        align-items: center;
        padding: 0.5rem 0.75rem;
        border-bottom: 1px solid var(--border-color);
        font-size: 0.85rem;
    }

        .ts-file-item:last-child {
            border-bottom: none;
        }

    .ts-file-name {
        flex: 1;
        font-family: 'Fira Code', monospace;
    }

    /* ==================== INFO BOX ==================== */
    .ts-info-box {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    [data-theme="dark"] .ts-info-box {
        background: rgba(99, 102, 241, 0.15);
    }

    /* ==================== OPTION GROUP ENHANCED ==================== */
    .ts-option-group .form-check-label i {
        font-size: 0.8rem;
    }
</style>

@* ============================================================================
   JAVASCRIPT DO TABSHEET WIZARD
   ============================================================================ *@
<script src="~/js/tabsheet/tabsheet.js" asp-append-version="true"></script>
