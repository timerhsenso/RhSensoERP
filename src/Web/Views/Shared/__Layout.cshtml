@*
    =============================================================================
    LAYOUT PRINCIPAL DO SISTEMA (AdminLTE + Menu Dinâmico)
    -----------------------------------------------------------------------------
    - Este layout usa o ViewComponent "DynamicMenu" para renderizar o menu lateral
      com base no MenuDiscoveryService e nos controllers marcados com [MenuItem].

    - Pontos principais:
        1) Cabeçalho (navbar superior)
        2) Menu lateral (sidebar) -> @await Component.InvokeAsync("DynamicMenu")
        3) Área de conteúdo -> @RenderBody()
        4) Rodapé
        5) Seções opcionais de scripts -> @RenderSection("Scripts", required: false)

    - Ajuste os caminhos de CSS/JS conforme seu projeto (wwwroot/lib, wwwroot/css, etc).
    =============================================================================
*@

@using RhSensoERP.Web.Services.Menu
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="pt-br">
<head>
    @* =========================================================================
       META TAGS BÁSICAS
       ========================================================================= *@
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - RhSensoERP</title>

    @* =========================================================================
       CSS PRINCIPAL
       - Ajuste os caminhos conforme seu projeto:
         - AdminLTE (css principal)
         - Font Awesome (ícones)
         - Bootstrap
         - site.css (estilos customizados do projeto)
       ========================================================================= *@

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="~/lib/adminlte/css/adminlte.min.css" />
    <link rel="stylesheet" href="~/css/site.css" />

    @* Se você tiver seções de CSS específicas por página, pode habilitar aqui
       @RenderSection("Styles", required: false)
    *@
</head>
<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">
        @* =========================================================================
           NAVBAR SUPERIOR
           ========================================================================= *@
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            @* Botão de toggle do menu lateral (ícone "hambúrguer") *@
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                        <i class="fas fa-bars"></i>
                    </a>
                </li>
                @* Link de "Home" ou outro atalho *@
                <li class="nav-item d-none d-sm-inline-block">
                    <a asp-area="" asp-controller="Home" asp-action="Index" class="nav-link">
                        Início
                    </a>
                </li>
            </ul>

            @* Busca ou outros itens à esquerda, se quiser *@
            <form class="form-inline ml-3 d-none d-md-block">
                <div class="input-group input-group-sm">
                    <input class="form-control form-control-navbar" type="search" placeholder="Pesquisar" aria-label="Search">
                    <div class="input-group-append">
                        <button class="btn btn-navbar" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>

            @* Itens do lado direito (usuário logado, notificações, etc.) *@
            <ul class="navbar-nav ml-auto">
                @* Notificações (exemplo) *@
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge">0</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <span class="dropdown-item dropdown-header">Sem notificações</span>
                    </div>
                </li>

                @* Menu do usuário *@
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-user"></i>
                        <span class="ml-1">@User.Identity?.Name</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a asp-controller="Account" asp-action="Profile" class="dropdown-item">
                            <i class="fas fa-id-badge mr-2"></i> Perfil
                        </a>
                        <a asp-controller="Account" asp-action="ChangePassword" class="dropdown-item">
                            <i class="fas fa-key mr-2"></i> Alterar Senha
                        </a>
                        <div class="dropdown-divider"></div>
                        <form asp-controller="Account" asp-action="Logout" method="post" class="dropdown-item p-0 m-0">
                            <button type="submit" class="btn btn-link btn-block text-left">
                                <i class="fas fa-sign-out-alt mr-2"></i> Sair
                            </button>
                        </form>
                    </div>
                </li>
            </ul>
        </nav>

        @* =========================================================================
           MENU LATERAL (SIDEBAR)
           - Aqui é onde o MENU DINÂMICO é injetado.
           - O DynamicMenuViewComponent chama o MenuDiscoveryService,
             que descobre os controllers com [MenuItem] e monta a estrutura.
           ========================================================================= *@
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            @* Logo / marca *@
            <a asp-area="" asp-controller="Home" asp-action="Index" class="brand-link">
                <img src="~/img/logo.png" alt="Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">RhSensoERP</span>
            </a>

            @* Painel do usuário na sidebar (opcional) *@
            <div class="sidebar">
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="~/img/user.png" class="img-circle elevation-2" alt="Usuário">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block">@User.Identity?.Name</a>
                    </div>
                </div>

                @* Campo de busca do menu (opcional) *@
                <div class="form-inline">
                    <div class="input-group" data-widget="sidebar-search">
                        <input class="form-control form-control-sidebar" type="search" placeholder="Buscar menu..." aria-label="Search">
                        <div class="input-group-append">
                            <button class="btn btn-sidebar">
                                <i class="fas fa-search fa-fw"></i>
                            </button>
                        </div>
                    </div>
                </div>

                @* ---------------------------------------------
                   AQUI ENTRA O MENU DINÂMICO
                   ---------------------------------------------
                   - O componente "DynamicMenu" recebe a lista de módulos
                     e itens já filtrados por permissão.
                   - A view Default.cshtml do componente é responsável por
                     montar o <ul> com os links (AdminLTE nav-sidebar).
                   --------------------------------------------- *@
                <nav class="mt-2">
                    @await Component.InvokeAsync("DynamicMenu")
                </nav>
            </div>
        </aside>

        @* =========================================================================
           ÁREA PRINCIPAL DE CONTEÚDO
           ========================================================================= *@
        <div class="content-wrapper">
            @* Cabeçalho da página (titulo, trilha de navegação/breadcrumb) *@
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>@ViewData["Title"]</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item">
                                    <a asp-controller="Home" asp-action="Index">Início</a>
                                </li>
                                @* Você pode complementar com mais itens dinamicamente via ViewData ou seção *@
                                <li class="breadcrumb-item active">@ViewData["Title"]</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </section>

            @* Conteúdo principal *@
            <section class="content">
                <div class="container-fluid">
                    @RenderBody()
                </div>
            </section>
        </div>

        @* =========================================================================
           RODAPÉ
           ========================================================================= *@
        <footer class="main-footer">
            <strong>&copy; @DateTime.Now.Year - RhSensoERP</strong>
            <div class="float-right d-none d-sm-inline-block">
                <b>Versão</b> 1.0.0
            </div>
        </footer>

        @* Control Sidebar (opcional) *@
        <aside class="control-sidebar control-sidebar-dark">
            @* Conteúdo opcional da barra lateral direita *@
        </aside>
    </div>

    @* =========================================================================
       SCRIPTS JS
       - Ajuste os caminhos conforme seus pacotes/lib em wwwroot.
       ========================================================================= *@
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/adminlte/js/adminlte.min.js"></script>
    <script src="~/js/site.js"></script>

    @* Seções de scripts adicionais das views *@
    @RenderSection("Scripts", required: false)
</body>
</html>
